---
title: "ABC212_H_solution.md"
tags: []
author: ""
created: ""
---

对于 nim 游戏，其结论是如果每堆石子的异或和为 $0$ 则后手赢，否则先手赢。

现在如果 $M=1$，观察到 $A_i<2^{16}$ 不是很大，因此设 $C_i$ 表示 $M$ 堆石子，异或和为 $i$ 的方案数，那么 $C_{A_i}=1$。

接下来考虑新加入一堆，容易发现就是一个异或卷积的过程。

异或卷积的定义是，现在有两个序列 $X,Y$，设 $Z=X\times Y$，表示 $X$ 与 $Y$ 的异或卷积。

$$
Z_k=\sum_{i\oplus j=k} X_iY_i
$$

那么可以发现，对于 $M>1$ 的情况，$C^M$ 就是得到的方案数。

答案就是要求 $\sum_{i=1}^N C^i$。

上面异或卷积的过程可以用快速沃尔什变换优化，具体而言，就是类似于求出点值，然后点值相乘再还原的过程。

那么上面这个过程只需要求出 $C$ 的点值，然后进行一个等比数列求和，再还原即可。

[code](https://atcoder.jp/contests/abc212/submissions/34303166)

